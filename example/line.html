<html>

<head>
  <meta charset="utf-8">
  <title>D3.js v4 Calendar Heatmap</title>
  <link rel="stylesheet" type="text/css" href="../src/calendar-heatmap.css">
  <link rel="stylesheet" type="text/css" href="../src/pdc-gauge.css">
  <link rel="stylesheet" 
    href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" 
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" 
    crossorigin="anonymous">
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <h1>Medication Review</h1>
        <h3>Mitt Coats</h3>
      </div>
      <div class="col-md-6">
        <p class="text-bold">Report Date</p>
        <p class="text-muted">15 Oct 2018</p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3">Atorvastatin</div>
      <div class="col-sm-3">1 Oral</div>
      <div class="col-sm-3">40 mg</div>
    </div>
    <div class="row">
      <div class="col-sm-3">Rx: 101317</div>
      <div class="col-sm-3">
        <p class="bold">Prescriber: <span>LIBERZON</span></p>
      </div>
    </div>
        <div class="row">
          <div class="col-sm-4">Prescriber:</div>
          <div class="col-sm-8">LIBERZON</div>
        </div>  
      </div>
    </div>
  </div>
  <hr>
  <div class="container">
    <div class="gauge m-auto"></div>
    <div class="chart"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment.min.js" charset="utf-8"></script>
  <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
  <script src="../src/calendar-heatmap_h.js"></script>
  <script src="../src/pdc-gauge.js"></script>
  <script type="text/javascript">
    var now = moment().endOf('day').toDate();
    var yearAgo = moment().startOf('day').subtract(1, 'year').toDate();
    var fillSize = 30;
    var coveredCount = 30;
    var gapCount = Math.floor(Math.random()*5);
    var gapTotal = 0;
    
    var chartData = d3.timeDays(yearAgo, now).map(function (dateElement) { 
      var gap;
      var coveredCount;
      if (this.gapCount > 0) {
        this.gapCount--;
        gap = true;
      } else if(this.coveredCount > 0){
        this.gapCount = 0;
        this.coveredCount--;
        gap = false;
      } else {
        this.gapCount = Math.floor(Math.random() * 20);
        this.gapTotal += this.gapCount;
        this.coveredCount = 30;
        gap = true;
      }

      if(gap ? coveredCount = 0 : coveredCount = this.coveredCount);

      return {
        date: dateElement,
        count: coveredCount,
        gap: gap
      };
    });
    var pdc = (365 - gapTotal) / 365;

    var heatmap = calendarHeatmap()
      .data(chartData)
      .selector('.chart')
      .tooltipEnabled(true)
      .colorRange(['#cc0000', '#37baab'])
      .onClick(function (data) {
        console.log('data', data);
      });
    
    heatmap();  // render the chart

    var gauge = pdcGauge()
      .pdc(pdc)
      .selector('.gauge');
    gauge();

  </script>
  <script></script>

</body>

</html>